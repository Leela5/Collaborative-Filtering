{"paragraphs":[{"text":"%spark2.pyspark\n\n### Recommend a model on count who as more than 1 events (view, addtocart, transaction)\n\n# Events data\n\nevents = spark.read.options(header=True, inferSchema=True).csv('/user/capstone/events.csv')","user":"anonymous","dateUpdated":"2018-07-30T16:07:48+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185986_1589056010","id":"20180728-225233_1592630379","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:23:18+0000","dateFinished":"2018-07-30T13:25:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:351"},{"text":"%spark2.pyspark\nevents.count()","user":"anonymous","dateUpdated":"2018-07-30T13:27:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2756101\n"}]},"apps":[],"jobName":"paragraph_1532917185986_1589056010","id":"20180729-184359_333334486","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:27:19+0000","dateFinished":"2018-07-30T13:27:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:352"},{"text":"%spark2.pyspark\nevents.show(3)","user":"anonymous","dateUpdated":"2018-07-30T13:27:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+---------+-----+------+-------------+\n|    timestamp|visitorid|event|itemid|transactionid|\n+-------------+---------+-----+------+-------------+\n|1433221332117|   257597| view|355908|         null|\n|1433224214164|   992329| view|248676|         null|\n|1433221999827|   111016| view|318965|         null|\n+-------------+---------+-----+------+-------------+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917185986_1589056010","id":"20180729-184420_1581574797","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:27:24+0000","dateFinished":"2018-07-30T13:27:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:353"},{"text":"%spark2.pyspark\n# GroupBy user's count on event\n\nvisitorGroupBy = events.groupBy('visitorid').count()","user":"anonymous","dateUpdated":"2018-07-30T13:27:40+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185986_1589056010","id":"20180728-225633_1158112561","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:27:40+0000","dateFinished":"2018-07-30T13:27:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:354"},{"text":"%spark2.pyspark\nvisitorGroupBy.show(3)","user":"anonymous","dateUpdated":"2018-07-30T13:27:45+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-----+\n|visitorid|count|\n+---------+-----+\n|   361387|   15|\n|  1282360|    5|\n|  1354794|    1|\n+---------+-----+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917185987_1588671261","id":"20180729-180351_1829448635","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:27:45+0000","dateFinished":"2018-07-30T13:28:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:355"},{"text":"%spark2.pyspark\n# Filter groupBy user who has more than two events\n\nvisitorGt1 = visitorGroupBy.filter(visitorGroupBy['count']>1)","user":"anonymous","dateUpdated":"2018-07-30T13:32:55+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185987_1588671261","id":"20180728-225727_647497027","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:32:55+0000","dateFinished":"2018-07-30T13:32:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:356"},{"text":"%spark2.pyspark\nvisitorGt1.count()","user":"anonymous","dateUpdated":"2018-07-30T13:32:58+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"406020\n"}]},"apps":[],"jobName":"paragraph_1532917185987_1588671261","id":"20180729-180558_999043121","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:32:58+0000","dateFinished":"2018-07-30T13:33:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:357"},{"text":"%spark2.pyspark\n# Join the groupBy user with events frequency\n\neventsJoinVisitorGt1 = events.join(visitorGt1, ['visitorid'])\n","user":"anonymous","dateUpdated":"2018-07-30T13:33:07+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185987_1588671261","id":"20180728-225846_281969543","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:33:07+0000","dateFinished":"2018-07-30T13:33:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:358"},{"text":"%spark2.pyspark\n\neventsJoinVisitorGt1.count()","user":"anonymous","dateUpdated":"2018-07-30T13:33:17+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1754541\n"}]},"apps":[],"jobName":"paragraph_1532917185987_1588671261","id":"20180729-184247_86132987","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:33:17+0000","dateFinished":"2018-07-30T13:33:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:359"},{"text":"%spark2.pyspark\neventsJoinVisitorGt1.show(5)","user":"anonymous","dateUpdated":"2018-07-30T13:34:05+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-------------+-----+------+-------------+-----+\n|visitorid|    timestamp|event|itemid|transactionid|count|\n+---------+-------------+-----+------+-------------+-----+\n|      496|1438745738297| view|269803|         null|    2|\n|      496|1439922144484| view|395920|         null|    2|\n|     1238|1438970280581| view| 76426|         null|    3|\n|     1238|1438970177401| view| 76426|         null|    3|\n|     1238|1438967704727| view| 76426|         null|    3|\n+---------+-------------+-----+------+-------------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917185988_1586747516","id":"20180729-184325_824188296","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:34:05+0000","dateFinished":"2018-07-30T13:34:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:360"},{"text":"%spark2.pyspark\n# Find distinct users with timestamp\n\neventsJoinVisitorGt1Distinct = eventsJoinVisitorGt1.distinct()\n","user":"anonymous","dateUpdated":"2018-07-30T13:34:15+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185989_1586362767","id":"20180728-225913_1346337612","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:34:15+0000","dateFinished":"2018-07-30T13:34:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:361"},{"text":"%spark2.pyspark\neventsJoinVisitorGt1Distinct.count()","user":"anonymous","dateUpdated":"2018-07-30T13:34:17+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1754081\n"}]},"apps":[],"jobName":"paragraph_1532917185990_1587517014","id":"20180728-231352_496001712","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:34:21+0000","dateFinished":"2018-07-30T13:34:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:362"},{"text":"%spark2.pyspark\neventsJoinVisitorGt1Distinct.show(5)","user":"anonymous","dateUpdated":"2018-07-30T13:34:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-------------+-----+------+-------------+-----+\n|visitorid|    timestamp|event|itemid|transactionid|count|\n+---------+-------------+-----+------+-------------+-----+\n|      496|1438745738297| view|269803|         null|    2|\n|      496|1439922144484| view|395920|         null|    2|\n|     1238|1438970280581| view| 76426|         null|    3|\n|     1238|1438970177401| view| 76426|         null|    3|\n|     1238|1438967704727| view| 76426|         null|    3|\n+---------+-------------+-----+------+-------------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917185990_1587517014","id":"20180729-185600_1792964534","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:34:21+0000","dateFinished":"2018-07-30T13:35:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:363"},{"text":"%spark2.pyspark\n#Assign the values to each event\n\nviewreplace = eventsJoinVisitorGt1Distinct.replace({'view':'1'})\n","user":"anonymous","dateUpdated":"2018-07-30T13:34:43+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185990_1587517014","id":"20180728-230436_1078749668","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:34:45+0000","dateFinished":"2018-07-30T13:35:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:364"},{"text":"%spark2.pyspark\naddtocartreplace = viewreplace.replace({'addtocart':'2'})\n","user":"anonymous","dateUpdated":"2018-07-30T13:34:58+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185991_1587132265","id":"20180728-231235_414888532","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:35:03+0000","dateFinished":"2018-07-30T13:35:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:365"},{"text":"%spark2.pyspark\nfinal = addtocartreplace.replace({'transaction':'3'})","user":"anonymous","dateUpdated":"2018-07-30T13:35:10+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185991_1587132265","id":"20180728-231232_125734142","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:35:10+0000","dateFinished":"2018-07-30T13:35:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:366"},{"text":"%spark2.pyspark\n\n# Extract the columns for MatrixFactorization for ALS\n\ndata_1 = final['visitorid','itemid','event']\n\ndata_1.show(5)","user":"anonymous","dateUpdated":"2018-07-30T13:35:14+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+------+-----+\n|visitorid|itemid|event|\n+---------+------+-----+\n|      496|269803|    1|\n|      496|395920|    1|\n|     1238| 76426|    1|\n|     1238| 76426|    1|\n|     1238| 76426|    1|\n+---------+------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917185991_1587132265","id":"20180728-230747_1331559266","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:35:14+0000","dateFinished":"2018-07-30T13:35:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:367"},{"text":"%spark2.pyspark\n\n# distinct final data to avoid redudence of data\n\ndata = data_1.distinct()\n\ndata.count()\n","user":"anonymous","dateUpdated":"2018-07-30T13:35:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1213862\n"}]},"apps":[],"jobName":"paragraph_1532917185991_1587132265","id":"20180728-230953_561790893","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:35:19+0000","dateFinished":"2018-07-30T13:36:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:368"},{"text":"%spark2.pyspark\ndata.show(5)","user":"anonymous","dateUpdated":"2018-07-30T13:36:23+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+------+-----+\n|visitorid|itemid|event|\n+---------+------+-----+\n|      496|269803|    1|\n|      496|395920|    1|\n|     1238| 76426|    1|\n|     1580| 29100|    1|\n|     1645|  6432|    1|\n+---------+------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917185991_1587132265","id":"20180728-231527_864754339","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:36:24+0000","dateFinished":"2018-07-30T13:37:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:369"},{"text":"%spark2.pyspark\n#  Save the data file into hdfs\n\ndata.coalesce(1).write.option('header','true').csv('/user/maria_dev/CountGt1VisitorsDistinct.csv')","user":"anonymous","dateUpdated":"2018-07-30T13:36:13+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185992_1585208521","id":"20180728-231157_55984759","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:36:13+0000","dateFinished":"2018-07-30T13:36:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:370"},{"text":"%spark2.pyspark\n# Creating RDD file\ndataGt1 = sc.textFile('/user/maria_dev/CountGt1VisitorsDistinct.csv')\n\ntype(data)","user":"anonymous","dateUpdated":"2018-07-30T13:37:36+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.sql.dataframe.DataFrame'>\n"}]},"apps":[],"jobName":"paragraph_1532917185992_1585208521","id":"20180728-231456_704685480","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:37:36+0000","dateFinished":"2018-07-30T13:37:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:371"},{"text":"%spark2.pyspark\ndataGt1.count()","user":"anonymous","dateUpdated":"2018-07-30T13:37:39+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1213863\n"}]},"apps":[],"jobName":"paragraph_1532957846105_-247253162","id":"20180730-133726_1305276107","dateCreated":"2018-07-30T13:37:26+0000","dateStarted":"2018-07-30T13:37:39+0000","dateFinished":"2018-07-30T13:37:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:372"},{"text":"%spark2.pyspark\ndataGt1.first()","user":"anonymous","dateUpdated":"2018-07-30T13:37:52+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"u'visitorid,itemid,event'\n"}]},"apps":[],"jobName":"paragraph_1532917185992_1585208521","id":"20180729-181347_1413866809","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:37:53+0000","dateFinished":"2018-07-30T13:37:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:373"},{"text":"%spark2.pyspark\nheader=dataGt1.first()","user":"anonymous","dateUpdated":"2018-07-30T13:38:21+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185992_1585208521","id":"20180728-231646_1112878204","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:38:21+0000","dateFinished":"2018-07-30T13:38:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:374"},{"text":"%spark2.pyspark\ndataWithNoHeader = dataGt1.filter(lambda x: x!=header)\n","user":"anonymous","dateUpdated":"2018-07-30T13:38:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185993_1584823772","id":"20180728-231811_1136839655","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:38:26+0000","dateFinished":"2018-07-30T13:38:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:375"},{"text":"%spark2.pyspark\ndataWithNoHeader.first()\n","user":"anonymous","dateUpdated":"2018-07-30T13:38:33+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"u'496,269803,1'\n"}]},"apps":[],"jobName":"paragraph_1532917185993_1584823772","id":"20180728-232133_180828303","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:38:34+0000","dateFinished":"2018-07-30T13:38:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:376"},{"text":"%spark2.pyspark\n# Load ALS module, MatrixFactorizationModel, Rating for Collaborative Filtering\n\nfrom pyspark.mllib.recommendation import ALS, MatrixFactorizationModel, Rating\n\nCountRating = dataWithNoHeader.map(lambda x: x.split(','))\\\n.map(lambda x: Rating(int(x[0]), int(x[1]), float(x[2])))","user":"anonymous","dateUpdated":"2018-07-30T13:38:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185993_1584823772","id":"20180728-232141_969569491","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:38:50+0000","dateFinished":"2018-07-30T13:38:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:377"},{"text":"%spark2.pyspark\ntype(CountRating)","user":"anonymous","dateUpdated":"2018-07-30T13:38:56+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.rdd.PipelinedRDD'>\n"}]},"apps":[],"jobName":"paragraph_1532917185993_1584823772","id":"20180728-232202_2113268056","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:38:56+0000","dateFinished":"2018-07-30T13:38:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:378"},{"text":"%spark2.pyspark\ndf = sqlContext.createDataFrame(CountRating)\n","user":"anonymous","dateUpdated":"2018-07-30T13:39:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917185993_1584823772","id":"20180728-232213_328956731","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:39:02+0000","dateFinished":"2018-07-30T13:39:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:379"},{"text":"%spark2.pyspark\ndf.count()","user":"anonymous","dateUpdated":"2018-07-30T19:19:23+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1213862\n"}]},"apps":[],"jobName":"paragraph_1532917185993_1584823772","id":"20180728-233019_193966343","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:39:11+0000","dateFinished":"2018-07-30T13:39:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:380"},{"text":"%spark2.pyspark\n# # Data exploration on CountVisitor\n# Distinct Users\n\ndf.select('user').distinct().show(5)\n","user":"anonymous","dateUpdated":"2018-07-30T13:39:57+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+\n|  user|\n+------+\n| 15846|\n|160820|\n|342088|\n|652700|\n|703028|\n+------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917185993_1584823772","id":"20180728-233223_979417442","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:39:57+0000","dateFinished":"2018-07-30T13:40:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:381"},{"text":"%spark2.pyspark\n# Distinct Users's count\n\ndf.select('user').distinct().count()","user":"anonymous","dateUpdated":"2018-07-30T13:40:25+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"406020\n"}]},"apps":[],"jobName":"paragraph_1532917185994_1585978018","id":"20180728-233337_113725978","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:40:25+0000","dateFinished":"2018-07-30T13:40:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:382"},{"text":"%spark2.pyspark\ndf.select('product').distinct().show(5)","user":"anonymous","dateUpdated":"2018-07-30T13:40:35+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+\n|product|\n+-------+\n| 186376|\n| 241022|\n|  55474|\n| 421024|\n|  43367|\n+-------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917185994_1585978018","id":"20180728-233509_762404244","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:40:35+0000","dateFinished":"2018-07-30T13:41:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:383"},{"text":"%spark2.pyspark\ndf.groupBy('user').count().take(5)","user":"anonymous","dateUpdated":"2018-07-30T13:41:14+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[Row(user=15846, count=2), Row(user=160820, count=4), Row(user=342088, count=2), Row(user=652700, count=20), Row(user=703028, count=2)]\n"}]},"apps":[],"jobName":"paragraph_1532917185994_1585978018","id":"20180729-194520_1284449294","dateCreated":"2018-07-30T02:19:45+0000","dateStarted":"2018-07-30T13:41:14+0000","dateFinished":"2018-07-30T13:42:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:384"},{"text":"%spark2.pyspark\n# GroupBy User stats\n\ndf.groupBy('user').count().select('count').describe().show()","user":"anonymous","dateUpdated":"2018-07-30T13:41:17+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------------------+\n|summary|             count|\n+-------+------------------+\n|  count|            406020|\n|   mean|  2.98966060785183|\n| stddev|15.823784488161328|\n|    min|                 1|\n|    max|              4964|\n+-------+------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1532917186012_1589825507","id":"20180729-194549_1126321185","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:41:27+0000","dateFinished":"2018-07-30T13:42:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:385"},{"text":"%spark2.pyspark\ndf.stat.crosstab('user','rating').show(5)","user":"anonymous","dateUpdated":"2018-07-30T13:41:59+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+---+---+---+\n|user_rating|1.0|2.0|3.0|\n+-----------+---+---+---+\n|    1253013|  3|  0|  0|\n|     895344|  2|  0|  0|\n|     999043|  2|  0|  0|\n|     921558|  2|  0|  0|\n|    1042949|  4|  0|  0|\n+-----------+---+---+---+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917186012_1589825507","id":"20180729-194612_1700581471","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:42:05+0000","dateFinished":"2018-07-30T13:43:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:386"},{"text":"%spark2.pyspark\n# Splitting the CountRating data\n\n(training,test) = CountRating.randomSplit([0.8,0.2])\n","user":"anonymous","dateUpdated":"2018-07-30T13:43:16+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186012_1589825507","id":"20180728-233645_113577989","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:43:16+0000","dateFinished":"2018-07-30T13:43:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:387"},{"text":"%spark2.pyspark\ntraining.count()","user":"anonymous","dateUpdated":"2018-07-30T13:43:29+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"971322\n"}]},"apps":[],"jobName":"paragraph_1532917186012_1589825507","id":"20180728-233926_315794366","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:43:29+0000","dateFinished":"2018-07-30T13:43:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:388"},{"text":"%spark2.pyspark\ntest.count()","user":"anonymous","dateUpdated":"2018-07-30T13:43:36+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"242540\n"}]},"apps":[],"jobName":"paragraph_1532917186013_1589440758","id":"20180728-233935_8886969","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:43:36+0000","dateFinished":"2018-07-30T13:44:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:389"},{"text":"%spark2.pyspark\n## 1. Build the recommendation model using Alternating Least Squares\n\n# Call the ALS.train mehod to train the model\n\nfrom pyspark.mllib.recommendation import ALS, MatrixFactorizationModel, Rating\n\nrank = 10\nnumIterations = 10\nmodel = ALS.trainImplicit(CountRating, rank, numIterations, alpha=0.01)","user":"anonymous","dateUpdated":"2018-07-30T13:43:58+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186013_1589440758","id":"20180728-233950_933763324","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:43:59+0000","dateFinished":"2018-07-30T13:45:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:390"},{"text":"%spark2.pyspark\nmodel\n","user":"anonymous","dateUpdated":"2018-07-30T13:44:27+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<pyspark.mllib.recommendation.MatrixFactorizationModel object at 0x7f5b0267a850>\n"}]},"apps":[],"jobName":"paragraph_1532917186013_1589440758","id":"20180729-000544_917471578","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:44:27+0000","dateFinished":"2018-07-30T13:45:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:391"},{"text":"%spark2.pyspark\n# Evaluate the model on training data\n\ntestdata = test.map(lambda r: (r[0],r[1]))\n\ntype(testdata)","user":"anonymous","dateUpdated":"2018-07-30T13:46:18+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.rdd.PipelinedRDD'>\n"}]},"apps":[],"jobName":"paragraph_1532917186013_1589440758","id":"20180729-000928_2024491531","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:46:18+0000","dateFinished":"2018-07-30T13:46:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:392"},{"text":"%spark2.pyspark\ntestdata.take(5)","user":"anonymous","dateUpdated":"2018-07-30T13:46:21+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[(496, 269803), (2866, 83908), (3997, 158114), (4101, 115244), (4101, 376365)]\n"}]},"apps":[],"jobName":"paragraph_1532917186013_1589440758","id":"20180729-000924_1803926636","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:46:21+0000","dateFinished":"2018-07-30T13:46:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:393"},{"text":"%spark2.pyspark\n# Making predictions\n\npred_ind = model.predict(1238, 76426)\npred_ind","user":"anonymous","dateUpdated":"2018-07-30T13:46:30+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.0019262091676213755\n"}]},"apps":[],"jobName":"paragraph_1532917186013_1589440758","id":"20180729-000921_1182479761","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:46:30+0000","dateFinished":"2018-07-30T13:46:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:394"},{"text":"%spark2.pyspark\nmodel.predictAll(testdata).map(lambda r: ((r[0], r[1]),r[2])).take(5)\n","user":"anonymous","dateUpdated":"2018-07-30T13:46:37+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[((182316, 141578), 1.0882278222742986e-09), ((182316, 453394), 4.328501229010258e-07), ((1339720, 158498), 1.6347024624925272e-06), ((1133078, 130865), 0.004666932087039164), ((449586, 412676), 4.384616472672641e-06)]\n"}]},"apps":[],"jobName":"paragraph_1532917186013_1589440758","id":"20180729-000915_507334772","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:46:37+0000","dateFinished":"2018-07-30T13:47:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:395"},{"text":"%spark2.pyspark\n# Recommend Products For Users method to generate the top N item recommendations for users\n\nrecommendItemsToUsers = model.recommendProductsForUsers(10)\n","user":"anonymous","dateUpdated":"2018-07-30T13:46:47+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186013_1589440758","id":"20180729-000908_886453244","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:46:47+0000","dateFinished":"2018-07-30T13:47:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:396"},{"text":"%spark2.pyspark\nrecommendItemsToUsers.take(1)\n","user":"anonymous","dateUpdated":"2018-07-30T13:47:43+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[(637100, (Rating(user=637100, product=38965, rating=0.0026915312215843707), Rating(user=637100, product=234255, rating=0.0021679220537586703), Rating(user=637100, product=241555, rating=0.0021358531506244453), Rating(user=637100, product=9877, rating=0.001998215137496734), Rating(user=637100, product=325310, rating=0.0017399707527331987), Rating(user=637100, product=420960, rating=0.001638734455105893), Rating(user=637100, product=206241, rating=0.0015982654318399594), Rating(user=637100, product=22926, rating=0.0015734659137447548), Rating(user=637100, product=290999, rating=0.0015383782746477709), Rating(user=637100, product=60980, rating=0.0015096630750091027)))]\n"}]},"apps":[],"jobName":"paragraph_1532917186013_1589440758","id":"20180729-001757_1723799723","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T13:47:43+0000","dateFinished":"2018-07-30T16:04:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:397"},{"text":"%spark2.pyspark\nrecommendUsersToItems = model.recommendUsersForProducts(10)","user":"anonymous","dateUpdated":"2018-07-30T16:24:55+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186014_1590595005","id":"20180729-232108_1406108526","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T16:24:55+0000","dateFinished":"2018-07-30T16:24:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:398"},{"text":"%spark2.pyspark\nrecommendUsersToItems.take(1)","user":"anonymous","dateUpdated":"2018-07-30T16:25:05+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[(185012, (Rating(user=163561, product=185012, rating=8.791158823074979e-05), Rating(user=286616, product=185012, rating=8.49404700178371e-05), Rating(user=138131, product=185012, rating=6.983311817191418e-05), Rating(user=53842, product=185012, rating=4.8477522615636893e-05), Rating(user=389532, product=185012, rating=4.062623982005371e-05), Rating(user=350566, product=185012, rating=3.985964789837738e-05), Rating(user=227091, product=185012, rating=3.083768228187945e-05), Rating(user=530559, product=185012, rating=3.047925132225478e-05), Rating(user=809822, product=185012, rating=2.903318886163379e-05), Rating(user=79627, product=185012, rating=2.7232511522191876e-05)))]\n"}]},"apps":[],"jobName":"paragraph_1532953514535_-782211711","id":"20180730-122514_114563977","dateCreated":"2018-07-30T12:25:14+0000","dateStarted":"2018-07-30T16:25:05+0000","dateFinished":"2018-07-30T18:41:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:399"},{"text":"%spark2.pyspark\nrecommendUsersToItems.count()","user":"anonymous","dateUpdated":"2018-07-30T20:08:02+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"166753\n"}]},"apps":[],"jobName":"paragraph_1532917186014_1590595005","id":"20180730-004049_1867346079","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:08:02+0000","dateFinished":"2018-07-30T20:08:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:400"},{"text":"%spark2.pyspark\nrecommendItemsToUsers.count()","user":"anonymous","dateUpdated":"2018-07-30T20:08:23+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"406020\n"}]},"apps":[],"jobName":"paragraph_1532917186014_1590595005","id":"20180729-202113_1992638714","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:08:23+0000","dateFinished":"2018-07-30T20:09:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:401"},{"text":"%spark2.pyspark\n# product and user features\nproductFeatures = model.productFeatures().collect()\n","user":"anonymous","dateUpdated":"2018-07-30T20:11:17+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186014_1590595005","id":"20180729-092239_1224090008","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:11:17+0000","dateFinished":"2018-07-30T20:11:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:402"},{"text":"%spark2.pyspark\nproductFeatures_1 = sqlContext.createDataFrame(productFeatures)\nmodel.userFeatures().collect()\nproductFeatures_1.show(3)\n","user":"anonymous","dateUpdated":"2018-07-30T20:11:31+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+--------------------+\n| _1|                  _2|\n+---+--------------------+\n|  6|[-1.1539863771758...|\n| 16|[-0.0018911607330...|\n| 22|[5.15686315338825...|\n+---+--------------------+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917186014_1590595005","id":"20180729-092232_31097979","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:11:31+0000","dateFinished":"2018-07-30T20:12:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:403"},{"text":"%spark2.pyspark\nfirst_product = model.productFeatures().take(1)[0]\nlatents = first_product[1]\nlen(latents)","user":"anonymous","dateUpdated":"2018-07-30T20:11:36+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"10\n"}]},"apps":[],"jobName":"paragraph_1532917186014_1590595005","id":"20180729-092517_834363949","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:11:37+0000","dateFinished":"2018-07-30T20:12:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:404"},{"text":"%spark2.pyspark\n# userFeatures\n\nfirst_user = model.userFeatures().take(1)[0]\nlatents = first_user[1]\nlen(latents)","user":"anonymous","dateUpdated":"2018-07-30T20:34:02+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"10\n"}]},"apps":[],"jobName":"paragraph_1532917186014_1590595005","id":"20180729-092513_1635720730","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:34:02+0000","dateFinished":"2018-07-30T20:34:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:405"},{"text":"%spark2.pyspark\nuserFeatures = model.userFeatures().collect()\nuserFeatures_1 = sqlContext.createDataFrame(userFeatures)\nuserFeatures_1.show(2)","user":"anonymous","dateUpdated":"2018-07-30T20:34:06+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+--------------------+\n| _1|                  _2|\n+---+--------------------+\n|  0|[-0.0011578487465...|\n|  2|[-0.0034697726368...|\n+---+--------------------+\nonly showing top 2 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917186014_1590595005","id":"20180729-092341_1230257101","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:34:06+0000","dateFinished":"2018-07-30T20:34:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:406"},{"text":"%spark2.pyspark\npredictions = model.predictAll(testdata).map(lambda r: ((r[0], r[1]),r[2]))\ntype(predictions)","user":"anonymous","dateUpdated":"2018-07-30T20:34:11+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.rdd.PipelinedRDD'>\n"}]},"apps":[],"jobName":"paragraph_1532917186015_1590210256","id":"20180729-093423_562104182","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:34:11+0000","dateFinished":"2018-07-30T20:34:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:407"},{"text":"%spark2.pyspark\n# Calculate rmse for ALS Collaborative Filtering\nfrom math import sqrt\n\nratesAndPreds = CountRating.map(lambda r: ((r[0],r[1]), r[2])).join(predictions)\n","user":"anonymous","dateUpdated":"2018-07-30T20:35:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186015_1590210256","id":"20180729-092649_1572629692","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:35:03+0000","dateFinished":"2018-07-30T20:35:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:408"},{"text":"%spark2.pyspark\nratesAndPreds.take(5)","user":"anonymous","dateUpdated":"2018-07-30T20:35:14+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[((1165148, 85774), (1.0, 0.08495247098147887)), ((836198, 167880), (1.0, 1.7943257177058e-07)), ((224323, 126335), (1.0, 5.192126618937253e-07)), ((462622, 143096), (1.0, 7.421782758725422e-06)), ((1038623, 78827), (1.0, 3.772172403236311e-06))]\n"}]},"apps":[],"jobName":"paragraph_1532917186015_1590210256","id":"20180729-092646_1924888875","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:35:14+0000","dateFinished":"2018-07-30T20:36:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:409"},{"text":"%spark2.pyspark\nMeanSquareError = ratesAndPreds.map(lambda r: (r[1][0]-r[1][1])**2).mean()\n\nprint(\"MeanSquareError = \" + str(MeanSquareError))","user":"anonymous","dateUpdated":"2018-07-30T20:35:21+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"MeanSquareError = 1.52786336687\n"}]},"apps":[],"jobName":"paragraph_1532917186015_1590210256","id":"20180729-092643_1020873174","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T20:35:21+0000","dateFinished":"2018-07-30T20:37:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:410"},{"text":"%spark2.pyspark\n# Root Mean Square Error\n\nfrom math import sqrt\nrmse = sqrt(MeanSquareError)\nprint(\"Root_Mean_Square_Error = \" + str(rmse))","user":"anonymous","dateUpdated":"2018-07-30T21:11:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Root_Mean_Square_Error = 1.23606770319\n"}]},"apps":[],"jobName":"paragraph_1532917186015_1590210256","id":"20180729-094139_430533134","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T21:11:35+0000","dateFinished":"2018-07-30T21:11:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:411"},{"text":"%spark2.pyspark\n## 2.  Model Evluation and Selection with Hyper Parameter Tuning\n\ndf = sqlContext.createDataFrame(CountRating)\n\ntype(df)","user":"anonymous","dateUpdated":"2018-07-30T21:15:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.sql.dataframe.DataFrame'>\n"}]},"apps":[],"jobName":"paragraph_1532917186015_1590210256","id":"20180729-092803_1834151664","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T21:15:26+0000","dateFinished":"2018-07-30T21:15:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:412"},{"text":"%spark2.pyspark\ndf.show(5)","user":"anonymous","dateUpdated":"2018-07-30T21:16:15+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----+-------+------+\n|user|product|rating|\n+----+-------+------+\n| 496| 269803|   1.0|\n| 496| 395920|   1.0|\n|1238|  76426|   1.0|\n|1580|  29100|   1.0|\n|1645|   6432|   1.0|\n+----+-------+------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1532917186015_1590210256","id":"20180729-092816_1371474640","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T21:16:15+0000","dateFinished":"2018-07-30T21:16:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:413"},{"text":"%spark2.pyspark\n# Split the input data into separate training and test datasets\n\n(training, test) = df.randomSplit([0.8,0.2])\n","user":"anonymous","dateUpdated":"2018-07-30T21:16:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186015_1590210256","id":"20180729-092812_612587088","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T21:16:22+0000","dateFinished":"2018-07-30T21:16:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:414"},{"text":"%spark2.pyspark\ntraining.count()","user":"anonymous","dateUpdated":"2018-07-30T21:16:33+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"970800\n"}]},"apps":[],"jobName":"paragraph_1532917186015_1590210256","id":"20180729-092808_1276634571","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T21:16:33+0000","dateFinished":"2018-07-30T21:16:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:415"},{"text":"%spark2.pyspark\ntest.count()","user":"anonymous","dateUpdated":"2018-07-30T21:16:40+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"243062\n"}]},"apps":[],"jobName":"paragraph_1532917186016_1575974547","id":"20180729-092635_560299345","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T21:16:40+0000","dateFinished":"2018-07-30T21:17:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:416"},{"text":"%spark2.pyspark\n# Apply implicit parameter to the data\n\nfrom pyspark.ml.recommendation import ALS\nals = ALS(implicitPrefs=True, userCol=\"user\", itemCol=\"product\", ratingCol=\"rating\", coldStartStrategy=\"drop\")\n","user":"anonymous","dateUpdated":"2018-07-30T22:14:48+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186016_1575974547","id":"20180729-092942_1630148843","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T22:14:48+0000","dateFinished":"2018-07-30T22:14:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:417"},{"text":"%spark2.pyspark\nals","user":"anonymous","dateUpdated":"2018-07-30T22:14:52+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"ALS_4a72ade28fdabf7f4090\n"}]},"apps":[],"jobName":"paragraph_1532917186016_1575974547","id":"20180729-093121_1297196177","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T22:14:52+0000","dateFinished":"2018-07-30T22:14:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:418"},{"text":"%spark2.pyspark\nals.explainParams()","user":"anonymous","dateUpdated":"2018-07-30T22:14:54+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\"alpha: alpha for implicit preference (default: 1.0)\\ncheckpointInterval: set checkpoint interval (>= 1) or disable checkpoint (-1). E.g. 10 means that the cache will get checkpointed every 10 iterations. Note: this setting will be ignored if the checkpoint directory is not set in the SparkContext. (default: 10)\\ncoldStartStrategy: strategy for dealing with unknown or new users/items at prediction time. This may be useful in cross-validation or production scenarios, for handling user/item ids the model has not seen in the training data. Supported values: 'nan', 'drop'. (default: nan, current: drop)\\nfinalStorageLevel: StorageLevel for ALS model factors. (default: MEMORY_AND_DISK)\\nimplicitPrefs: whether to use implicit preference (default: False, current: True)\\nintermediateStorageLevel: StorageLevel for intermediate datasets. Cannot be 'NONE'. (default: MEMORY_AND_DISK)\\nitemCol: column name for item ids. Ids must be within the integer value range. (default: item, current: product)\\nmaxIter: max number of iterations (>= 0). (default: 10)\\nnonnegative: whether to use nonnegative constraint for least squares (default: False)\\nnumItemBlocks: number of item blocks (default: 10)\\nnumUserBlocks: number of user blocks (default: 10)\\npredictionCol: prediction column name. (default: prediction)\\nrank: rank of the factorization (default: 10)\\nratingCol: column name for ratings (default: rating, current: rating)\\nregParam: regularization parameter (>= 0). (default: 0.1)\\nseed: random seed. (default: 593367982098446717)\\nuserCol: column name for user ids. Ids must be within the integer value range. (default: user, current: user)\"\n"}]},"apps":[],"jobName":"paragraph_1532917186016_1575974547","id":"20180729-093125_1476355061","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T22:14:54+0000","dateFinished":"2018-07-30T22:14:54+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:419"},{"text":"%spark2.pyspark\nfrom pyspark.ml import Pipeline\n\npipeline = Pipeline(stages=[als])","user":"anonymous","dateUpdated":"2018-07-30T22:15:01+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186016_1575974547","id":"20180729-093159_1271046875","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T22:15:01+0000","dateFinished":"2018-07-30T22:15:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:420"},{"text":"%spark2.pyspark\ntype(pipeline)","user":"anonymous","dateUpdated":"2018-07-30T22:15:05+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.ml.pipeline.Pipeline'>\n"}]},"apps":[],"jobName":"paragraph_1532917186016_1575974547","id":"20180729-093209_1705990970","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T22:15:05+0000","dateFinished":"2018-07-30T22:15:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:421"},{"text":"%spark2.pyspark\n# Set the params\n\nfrom pyspark.ml.tuning import CrossValidator, ParamGridBuilder\n\nparamImplicit = ParamGridBuilder()\\\n.addGrid(als.rank,[5,10])\\\n.addGrid(als.maxIter,[5,10])\\\n.addGrid(als.regParam,[1.0,5.0])\\\n.build()\n","user":"anonymous","dateUpdated":"2018-07-30T22:15:11+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186016_1575974547","id":"20180729-093242_1721272374","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T22:15:11+0000","dateFinished":"2018-07-30T22:15:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:422"},{"text":"%spark2.pyspark\nfrom pyspark.ml.evaluation import RegressionEvaluator\n\nevaluatoR = RegressionEvaluator(metricName='rmse', labelCol='rating')\n","user":"anonymous","dateUpdated":"2018-07-30T22:15:16+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186016_1575974547","id":"20180729-093751_537231161","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T22:15:17+0000","dateFinished":"2018-07-30T22:15:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:423"},{"text":"%spark2.pyspark\n# Fit the estimator using params\n\ncvImplicit = CrossValidator(estimator=als, estimatorParamMaps=paramImplicit, evaluator=evaluatoR, numFolds=3)\n","user":"anonymous","dateUpdated":"2018-07-30T22:15:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186017_1575589798","id":"20180729-093747_1271936691","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T22:15:24+0000","dateFinished":"2018-07-30T22:15:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:424"},{"text":"%spark2.pyspark\ncvModel = cvImplicit.fit(training)\n","user":"anonymous","dateUpdated":"2018-07-30T22:15:29+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186017_1575589798","id":"20180729-093743_982824652","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T22:15:30+0000","dateFinished":"2018-07-30T22:49:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:425"},{"text":"%spark2.pyspark\n# Fit the model\n\n# Select the model produced by the best performance set of params\npreds = cvModel.bestModel.transform(test)\n\npreds.take(1)\n","user":"anonymous","dateUpdated":"2018-07-30T22:15:41+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[Row(user=77390, product=496, rating=1.0, prediction=0.00019151998276356608)]\n"}]},"apps":[],"jobName":"paragraph_1532917186017_1575589798","id":"20180729-093852_1546716825","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T22:15:41+0000","dateFinished":"2018-07-30T22:50:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:426"},{"text":"%spark2.pyspark\nevaluator = RegressionEvaluator(metricName='rmse', labelCol='rating', predictionCol='prediction')\n\nevaluator","user":"anonymous","dateUpdated":"2018-07-30T23:01:14+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"RegressionEvaluator_4ad9a3786aa744000d6d\n"}]},"apps":[],"jobName":"paragraph_1532917186017_1575589798","id":"20180729-094035_906167842","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T23:01:15+0000","dateFinished":"2018-07-30T23:01:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:427"},{"text":"%spark2.pyspark\n# Find Root Mean Square Error\n\nrmse = evaluator.evaluate(preds)\n","user":"anonymous","dateUpdated":"2018-07-30T23:01:18+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1532917186017_1575589798","id":"20180729-094046_1335797558","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T23:01:18+0000","dateFinished":"2018-07-30T23:02:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:428"},{"text":"%spark2.pyspark\nprint(\"Root-mean-square error =\"+str(rmse))\n","user":"anonymous","dateUpdated":"2018-07-30T23:01:23+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Root-mean-square error =1.15712494152\n"}]},"apps":[],"jobName":"paragraph_1532917186017_1575589798","id":"20180729-094111_404881451","dateCreated":"2018-07-30T02:19:46+0000","dateStarted":"2018-07-30T23:01:23+0000","dateFinished":"2018-07-30T23:02:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:429"},{"text":"%spark2.pyspark\n","user":"anonymous","dateUpdated":"2018-07-30T23:01:25+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1532917186017_1575589798","id":"20180729-231708_772318823","dateCreated":"2018-07-30T02:19:46+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:430"}],"name":"Final_VisitorFrequencyGtOne","id":"2DP9BHMH5","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}