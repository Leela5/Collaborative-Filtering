{"paragraphs":[{"text":"%spark2.pyspark\n\n### Recommend a model on count who as more than two events (view, addtocart, transaction)\n\n# Events data\n\nevents = spark.read.options(header=True, inferSchema=True).csv('/user/capstone/events.csv')","dateUpdated":"2018-08-08T01:59:18+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430627_506688845","id":"20180728-225233_1592630379","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4847","user":"anonymous","dateFinished":"2018-08-08T01:59:36+0000","dateStarted":"2018-08-08T01:59:18+0000"},{"text":"%spark2.pyspark\nevents.count()","dateUpdated":"2018-08-08T01:59:20+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2756101\n"}]},"apps":[],"jobName":"paragraph_1533693430628_504765100","id":"20180729-184359_333334486","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4848","user":"anonymous","dateFinished":"2018-08-08T01:59:42+0000","dateStarted":"2018-08-08T01:59:20+0000"},{"text":"%spark2.pyspark\nevents.show(3)","dateUpdated":"2018-08-08T01:59:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+---------+-----+------+-------------+\n|    timestamp|visitorid|event|itemid|transactionid|\n+-------------+---------+-----+------+-------------+\n|1433221332117|   257597| view|355908|         null|\n|1433224214164|   992329| view|248676|         null|\n|1433221999827|   111016| view|318965|         null|\n+-------------+---------+-----+------+-------------+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430628_504765100","id":"20180729-184420_1581574797","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4849","user":"anonymous","dateFinished":"2018-08-08T01:59:48+0000","dateStarted":"2018-08-08T01:59:36+0000"},{"text":"%spark2.pyspark\n# GroupBy user's count on event\n\nvisitorGroupBy = events.groupBy('visitorid').count()","dateUpdated":"2018-08-08T01:59:29+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430628_504765100","id":"20180728-225633_1158112561","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4850","user":"anonymous","dateFinished":"2018-08-08T01:59:48+0000","dateStarted":"2018-08-08T01:59:42+0000"},{"text":"%spark2.pyspark\nvisitorGroupBy.show(3)","dateUpdated":"2018-08-08T01:59:31+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-----+\n|visitorid|count|\n+---------+-----+\n|   361387|   15|\n|  1282360|    5|\n|  1354794|    1|\n+---------+-----+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430629_504380351","id":"20180729-180351_1829448635","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4851","user":"anonymous","dateFinished":"2018-08-08T02:00:08+0000","dateStarted":"2018-08-08T01:59:48+0000"},{"text":"%spark2.pyspark\n# Filter groupBy user who has more than two events\n\nvisitorGt2 = visitorGroupBy.filter(visitorGroupBy['count']>2)","dateUpdated":"2018-08-08T01:59:59+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430630_505534598","id":"20180728-225727_647497027","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4852","user":"anonymous","dateFinished":"2018-08-08T02:00:08+0000","dateStarted":"2018-08-08T01:59:59+0000"},{"text":"%spark2.pyspark\nvisitorGt2.count()","dateUpdated":"2018-08-08T02:00:07+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"200028\n"}]},"apps":[],"jobName":"paragraph_1533693430630_505534598","id":"20180729-180558_999043121","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4853","user":"anonymous","dateFinished":"2018-08-08T02:00:22+0000","dateStarted":"2018-08-08T02:00:08+0000"},{"text":"%spark2.pyspark\n# Join the groupBy user with events frequency\n\neventsJoinVisitorGt2 = events.join(visitorGt2, ['visitorid'])\n","dateUpdated":"2018-08-08T02:00:17+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430630_505534598","id":"20180728-225846_281969543","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4854","user":"anonymous","dateFinished":"2018-08-08T02:00:22+0000","dateStarted":"2018-08-08T02:00:17+0000"},{"text":"%spark2.pyspark\n\neventsJoinVisitorGt2.count()","dateUpdated":"2018-08-08T02:00:25+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1342557\n"}]},"apps":[],"jobName":"paragraph_1533693430631_505149849","id":"20180729-184247_86132987","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4855","user":"anonymous","dateFinished":"2018-08-08T02:01:13+0000","dateStarted":"2018-08-08T02:00:26+0000"},{"text":"%spark2.pyspark\neventsJoinVisitorGt2.show(5)","dateUpdated":"2018-08-08T02:00:33+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-------------+-----+------+-------------+-----+\n|visitorid|    timestamp|event|itemid|transactionid|count|\n+---------+-------------+-----+------+-------------+-----+\n|     1238|1438970280581| view| 76426|         null|    3|\n|     1238|1438970177401| view| 76426|         null|    3|\n|     1238|1438967704727| view| 76426|         null|    3|\n|     2659|1439873167520| view|444820|         null|    3|\n|     2659|1439873142540| view|444820|         null|    3|\n+---------+-------------+-----+------+-------------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430632_503226104","id":"20180729-184325_824188296","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4856","user":"anonymous","dateFinished":"2018-08-08T02:01:36+0000","dateStarted":"2018-08-08T02:00:33+0000"},{"text":"%spark2.pyspark\n# Find distinct users with timestamp\n\neventsJoinVisitorGt2Distinct = eventsJoinVisitorGt2.distinct()\n","dateUpdated":"2018-08-08T02:01:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430632_503226104","id":"20180728-225913_1346337612","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4857","user":"anonymous","dateFinished":"2018-08-08T02:01:36+0000","dateStarted":"2018-08-08T02:01:26+0000"},{"text":"%spark2.pyspark\neventsJoinVisitorGt2Distinct.count()","dateUpdated":"2018-08-08T02:01:30+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1342128\n"}]},"apps":[],"jobName":"paragraph_1533693430633_502841356","id":"20180728-231352_496001712","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4858","user":"anonymous","dateFinished":"2018-08-08T02:02:10+0000","dateStarted":"2018-08-08T02:01:36+0000"},{"text":"%spark2.pyspark\neventsJoinVisitorGt2Distinct.show(5)","dateUpdated":"2018-08-08T02:01:32+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-------------+-----+------+-------------+-----+\n|visitorid|    timestamp|event|itemid|transactionid|count|\n+---------+-------------+-----+------+-------------+-----+\n|     1238|1438970280581| view| 76426|         null|    3|\n|     1238|1438970177401| view| 76426|         null|    3|\n|     1238|1438967704727| view| 76426|         null|    3|\n|     2659|1439873167520| view|444820|         null|    3|\n|     2659|1439873142540| view|444820|         null|    3|\n+---------+-------------+-----+------+-------------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430633_502841356","id":"20180729-185600_1792964534","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4859","user":"anonymous","dateFinished":"2018-08-08T02:02:28+0000","dateStarted":"2018-08-08T02:01:36+0000"},{"text":"%spark2.pyspark\n#Assign the values to each event\n\nviewreplace = eventsJoinVisitorGt2Distinct.replace({'view':'1'})\n","dateUpdated":"2018-08-08T02:02:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430634_503995602","id":"20180728-230436_1078749668","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4860","user":"anonymous","dateFinished":"2018-08-08T02:02:28+0000","dateStarted":"2018-08-08T02:02:11+0000"},{"text":"%spark2.pyspark\naddtocartreplace = viewreplace.replace({'addtocart':'2'})\n","dateUpdated":"2018-08-08T02:02:05+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430634_503995602","id":"20180728-231235_414888532","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4861","user":"anonymous","dateFinished":"2018-08-08T02:02:28+0000","dateStarted":"2018-08-08T02:02:28+0000"},{"text":"%spark2.pyspark\nfinal = addtocartreplace.replace({'transaction':'3'})","dateUpdated":"2018-08-08T02:02:08+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430635_503610853","id":"20180728-231232_125734142","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4862","user":"anonymous","dateFinished":"2018-08-08T02:02:28+0000","dateStarted":"2018-08-08T02:02:28+0000"},{"text":"%spark2.pyspark\n\n# Extract the columns for MatrixFactorization for ALS\n\ndata_1 = final['visitorid','itemid','event']\n\ndata_1.show(5)","dateUpdated":"2018-08-08T02:02:42+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+------+-----+\n|visitorid|itemid|event|\n+---------+------+-----+\n|     1238| 76426|    1|\n|     1238| 76426|    1|\n|     1238| 76426|    1|\n|     2659|444820|    1|\n|     2659|444820|    1|\n+---------+------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430635_503610853","id":"20180728-230747_1331559266","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4863","user":"anonymous","dateFinished":"2018-08-08T02:03:06+0000","dateStarted":"2018-08-08T02:02:42+0000"},{"text":"%spark2.pyspark\n\n# distinct final data to avoid redudence of data\n\ndata = data_1.distinct()\n\ndata.count()\n","dateUpdated":"2018-08-08T02:02:44+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"881845\n"}]},"apps":[],"jobName":"paragraph_1533693430636_501687109","id":"20180728-230953_561790893","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4864","user":"anonymous","dateFinished":"2018-08-08T02:03:52+0000","dateStarted":"2018-08-08T02:02:44+0000"},{"text":"%spark2.pyspark\ndata.show(5)","dateUpdated":"2018-08-08T02:02:48+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+------+-----+\n|visitorid|itemid|event|\n+---------+------+-----+\n|     1238| 76426|    1|\n|     2659|444820|    1|\n|     2659|293297|    1|\n|     2866| 90950|    1|\n|     2866|294615|    1|\n+---------+------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430636_501687109","id":"20180728-231527_864754339","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4865","user":"anonymous","dateFinished":"2018-08-08T02:04:27+0000","dateStarted":"2018-08-08T02:03:06+0000"},{"text":"%spark2.pyspark\n#  Save the data file into hdfs\n\ndata.coalesce(1).write.option('header','true').csv('/user/maria_dev/CountGt2VisitorsDistinct.csv')","dateUpdated":"2018-08-08T02:02:57+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430637_501302360","id":"20180728-231157_55984759","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4866","user":"anonymous","dateFinished":"2018-08-08T02:05:07+0000","dateStarted":"2018-08-08T02:03:53+0000"},{"text":"%spark2.pyspark\n# Creating RDD file\ndataGt1 = sc.textFile('/user/maria_dev/CountGt2VisitorsDistinct.csv')\n\ntype(data)","dateUpdated":"2018-08-08T02:03:00+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.sql.dataframe.DataFrame'>\n"}]},"apps":[],"jobName":"paragraph_1533693430638_502456607","id":"20180728-231456_704685480","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4867","user":"anonymous","dateFinished":"2018-08-08T02:05:07+0000","dateStarted":"2018-08-08T02:04:27+0000"},{"text":"%spark2.pyspark\ndataGt1.count()","dateUpdated":"2018-08-08T02:03:18+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"881846\n"}]},"apps":[],"jobName":"paragraph_1533693430638_502456607","id":"20180730-133726_1305276107","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4868","user":"anonymous","dateFinished":"2018-08-08T02:05:14+0000","dateStarted":"2018-08-08T02:05:07+0000"},{"text":"%spark2.pyspark\ndataGt1.first()","dateUpdated":"2018-08-08T02:03:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"u'visitorid,itemid,event'\n"}]},"apps":[],"jobName":"paragraph_1533693430639_502071858","id":"20180729-181347_1413866809","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4869","user":"anonymous","dateFinished":"2018-08-08T02:05:15+0000","dateStarted":"2018-08-08T02:05:08+0000"},{"text":"%spark2.pyspark\nheader=dataGt1.first()","dateUpdated":"2018-08-08T02:03:27+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430640_512460078","id":"20180728-231646_1112878204","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4870","user":"anonymous","dateFinished":"2018-08-08T02:05:15+0000","dateStarted":"2018-08-08T02:05:15+0000"},{"text":"%spark2.pyspark\ndataWithNoHeader = dataGt1.filter(lambda x: x!=header)\n","dateUpdated":"2018-08-08T02:03:29+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430640_512460078","id":"20180728-231811_1136839655","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4871","user":"anonymous","dateFinished":"2018-08-08T02:05:15+0000","dateStarted":"2018-08-08T02:05:15+0000"},{"text":"%spark2.pyspark\ndataWithNoHeader.first()\n","dateUpdated":"2018-08-08T02:03:32+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"u'1238,76426,1'\n"}]},"apps":[],"jobName":"paragraph_1533693430641_512075329","id":"20180728-232133_180828303","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4872","user":"anonymous","dateFinished":"2018-08-08T02:05:15+0000","dateStarted":"2018-08-08T02:05:15+0000"},{"text":"%spark2.pyspark\n# Load ALS module, MatrixFactorizationModel, Rating for Collaborative Filtering\n\nfrom pyspark.mllib.recommendation import ALS, MatrixFactorizationModel, Rating\n\nCountRating = dataWithNoHeader.map(lambda x: x.split(','))\\\n.map(lambda x: Rating(int(x[0]), int(x[1]), float(x[2])))","dateUpdated":"2018-08-08T02:03:48+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430641_512075329","id":"20180728-232141_969569491","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4873","user":"anonymous","dateFinished":"2018-08-08T02:05:15+0000","dateStarted":"2018-08-08T02:05:15+0000"},{"text":"%spark2.pyspark\ntype(CountRating)","dateUpdated":"2018-08-08T02:03:52+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.rdd.PipelinedRDD'>\n"}]},"apps":[],"jobName":"paragraph_1533693430642_513229576","id":"20180728-232202_2113268056","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4874","user":"anonymous","dateFinished":"2018-08-08T02:05:15+0000","dateStarted":"2018-08-08T02:05:15+0000"},{"text":"%spark2.pyspark\ndf = sqlContext.createDataFrame(CountRating)\n","dateUpdated":"2018-08-08T02:03:57+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430643_512844827","id":"20180728-232213_328956731","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4875","user":"anonymous","dateFinished":"2018-08-08T02:05:16+0000","dateStarted":"2018-08-08T02:05:15+0000"},{"text":"%spark2.pyspark\ndf.count()","dateUpdated":"2018-08-08T02:04:02+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"881845\n"}]},"apps":[],"jobName":"paragraph_1533693430644_510921082","id":"20180728-233019_193966343","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4876","user":"anonymous","dateFinished":"2018-08-08T02:05:34+0000","dateStarted":"2018-08-08T02:05:16+0000"},{"text":"%spark2.pyspark\n# # Data exploration on CountVisitor\n# Distinct Users\n\ndf.select('user').distinct().show(5)\n","dateUpdated":"2018-08-08T02:04:06+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+\n|   user|\n+-------+\n| 160820|\n| 652700|\n| 703028|\n| 978440|\n|1181937|\n+-------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430644_510921082","id":"20180728-233223_979417442","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4877","user":"anonymous","dateFinished":"2018-08-08T02:05:51+0000","dateStarted":"2018-08-08T02:05:17+0000"},{"text":"%spark2.pyspark\n# Distinct Users's count\n\ndf.select('user').distinct().count()","dateUpdated":"2018-08-08T02:04:38+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"200028\n"}]},"apps":[],"jobName":"paragraph_1533693430645_510536334","id":"20180728-233337_113725978","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4878","user":"anonymous","dateFinished":"2018-08-08T02:06:17+0000","dateStarted":"2018-08-08T02:05:34+0000"},{"text":"%spark2.pyspark\ndf.select('product').distinct().show(5)","dateUpdated":"2018-08-08T02:04:40+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+\n|product|\n+-------+\n| 186376|\n| 241022|\n|  55474|\n| 161736|\n| 253815|\n+-------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430646_511690580","id":"20180728-233509_762404244","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4879","user":"anonymous","dateFinished":"2018-08-08T02:06:34+0000","dateStarted":"2018-08-08T02:05:51+0000"},{"text":"%spark2.pyspark\ndf.groupBy('user').count().take(5)","dateUpdated":"2018-08-08T02:04:45+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[Row(user=160820, count=4), Row(user=652700, count=20), Row(user=703028, count=2), Row(user=978440, count=2), Row(user=1181937, count=2)]\n"}]},"apps":[],"jobName":"paragraph_1533693430647_511305831","id":"20180729-194520_1284449294","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4880","user":"anonymous","dateFinished":"2018-08-08T02:07:07+0000","dateStarted":"2018-08-08T02:06:18+0000"},{"text":"%spark2.pyspark\n# GroupBy User stats\n\ndf.groupBy('user').count().select('count').describe().show()","dateUpdated":"2018-08-08T02:04:46+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-----------------+\n|summary|            count|\n+-------+-----------------+\n|  count|           200028|\n|   mean|4.408607794908713|\n| stddev|  22.450793218722|\n|    min|                1|\n|    max|             4964|\n+-------+-----------------+\n\n"}]},"apps":[],"jobName":"paragraph_1533693430647_511305831","id":"20180729-194549_1126321185","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4881","user":"anonymous","dateFinished":"2018-08-08T02:07:29+0000","dateStarted":"2018-08-08T02:06:34+0000"},{"text":"%spark2.pyspark\ndf.stat.crosstab('user','rating').show(5)","dateUpdated":"2018-08-08T02:04:50+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+---+---+---+\n|user_rating|1.0|2.0|3.0|\n+-----------+---+---+---+\n|    1253013|  3|  0|  0|\n|     999043|  2|  0|  0|\n|    1042949|  4|  0|  0|\n|     402012|  2|  0|  0|\n|     922480|  3|  0|  0|\n+-----------+---+---+---+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430648_509382087","id":"20180729-194612_1700581471","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4882","user":"anonymous","dateFinished":"2018-08-08T02:07:55+0000","dateStarted":"2018-08-08T02:07:07+0000"},{"text":"%spark2.pyspark\n# Splitting the CountRating data\n\n(training,test) = CountRating.randomSplit([0.8,0.2])\n","dateUpdated":"2018-08-08T02:04:59+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430649_508997338","id":"20180728-233645_113577989","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4883","user":"anonymous","dateFinished":"2018-08-08T02:07:55+0000","dateStarted":"2018-08-08T02:07:29+0000"},{"text":"%spark2.pyspark\ntraining.count()","dateUpdated":"2018-08-08T02:05:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"705632\n"}]},"apps":[],"jobName":"paragraph_1533693430649_508997338","id":"20180728-233926_315794366","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4884","user":"anonymous","dateFinished":"2018-08-08T02:08:16+0000","dateStarted":"2018-08-08T02:07:55+0000"},{"text":"%spark2.pyspark\ntest.count()","dateUpdated":"2018-08-08T02:05:05+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"176213\n"}]},"apps":[],"jobName":"paragraph_1533693430650_510151585","id":"20180728-233935_8886969","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4885","user":"anonymous","dateFinished":"2018-08-08T02:08:32+0000","dateStarted":"2018-08-08T02:07:55+0000"},{"text":"%spark2.pyspark\n## 1. Build the recommendation model using Alternating Least Squares\n\n# Call the ALS.train mehod to train the model\n\nfrom pyspark.mllib.recommendation import ALS, MatrixFactorizationModel, Rating\n\nrank = 10\nnumIterations = 10\nmodel = ALS.trainImplicit(CountRating, rank, numIterations, alpha=0.01)","dateUpdated":"2018-08-08T02:05:07+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430651_509766836","id":"20180728-233950_933763324","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4886","user":"anonymous","dateFinished":"2018-08-08T02:09:28+0000","dateStarted":"2018-08-08T02:08:17+0000"},{"text":"%spark2.pyspark\nmodel\n","dateUpdated":"2018-08-08T02:05:14+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<pyspark.mllib.recommendation.MatrixFactorizationModel object at 0x7f57d9696c10>\n"}]},"apps":[],"jobName":"paragraph_1533693430652_507843091","id":"20180729-000544_917471578","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4887","user":"anonymous","dateFinished":"2018-08-08T02:09:28+0000","dateStarted":"2018-08-08T02:08:32+0000"},{"text":"%spark2.pyspark\n# Evaluate the model on training data\n\ntestdata = test.map(lambda r: (r[0],r[1]))\n\ntype(testdata)","dateUpdated":"2018-08-08T02:05:18+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.rdd.PipelinedRDD'>\n"}]},"apps":[],"jobName":"paragraph_1533693430652_507843091","id":"20180729-000928_2024491531","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4888","user":"anonymous","dateFinished":"2018-08-08T02:09:28+0000","dateStarted":"2018-08-08T02:09:28+0000"},{"text":"%spark2.pyspark\ntestdata.take(5)","dateUpdated":"2018-08-08T02:05:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[(2659, 444820), (4101, 376365), (4101, 320620), (4101, 356690), (4101, 230099)]\n"}]},"apps":[],"jobName":"paragraph_1533693430654_508612589","id":"20180729-000924_1803926636","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4889","user":"anonymous","dateFinished":"2018-08-08T02:09:29+0000","dateStarted":"2018-08-08T02:09:28+0000"},{"text":"%spark2.pyspark\n# Making predictions\n\npred_ind = model.predict(1238, 76426)\npred_ind","dateUpdated":"2018-08-08T02:05:24+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.0014361186578474479\n"}]},"apps":[],"jobName":"paragraph_1533693430654_508612589","id":"20180729-000921_1182479761","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4890","user":"anonymous","dateFinished":"2018-08-08T02:09:29+0000","dateStarted":"2018-08-08T02:09:29+0000"},{"text":"%spark2.pyspark\nmodel.predictAll(testdata).map(lambda r: ((r[0], r[1]),r[2])).take(5)\n","dateUpdated":"2018-08-08T02:05:28+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[((987162, 231684), 2.120387654026262e-06), ((987162, 393111), 0.0030646809316581592), ((182316, 453394), 2.6692274876989967e-07), ((1174034, 405862), 8.045011330702073e-05), ((153030, 101865), 2.7238418641445033e-06)]\n"}]},"apps":[],"jobName":"paragraph_1533693430655_508227840","id":"20180729-000915_507334772","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4891","user":"anonymous","dateFinished":"2018-08-08T02:10:10+0000","dateStarted":"2018-08-08T02:09:29+0000"},{"text":"%spark2.pyspark\n# Recommend Products For Users method to generate the top N item recommendations for users\n\nrecommendItemsToUsers = model.recommendProductsForUsers(10)\n","dateUpdated":"2018-08-08T02:05:30+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430656_592487849","id":"20180729-000908_886453244","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4892","user":"anonymous","dateFinished":"2018-08-08T02:10:10+0000","dateStarted":"2018-08-08T02:09:29+0000"},{"text":"%spark2.pyspark\nrecommendItemsToUsers.take(1)\n","dateUpdated":"2018-08-08T02:05:32+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[(637100, (Rating(user=637100, product=234255, rating=0.0020382931270605895), Rating(user=637100, product=190000, rating=0.0018992172226996588), Rating(user=637100, product=119736, rating=0.001877843417967344), Rating(user=637100, product=420960, rating=0.00178903444223209), Rating(user=637100, product=38965, rating=0.0016554862289162072), Rating(user=637100, product=399192, rating=0.0015144951567053568), Rating(user=637100, product=22926, rating=0.0014703510778855408), Rating(user=637100, product=290999, rating=0.0014637806510831612), Rating(user=637100, product=138427, rating=0.0014254098378956026), Rating(user=637100, product=9877, rating=0.0014166442517118112)))]\n"}]},"apps":[],"jobName":"paragraph_1533693430656_592487849","id":"20180729-001757_1723799723","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4893","user":"anonymous","dateFinished":"2018-08-08T03:04:52+0000","dateStarted":"2018-08-08T02:10:10+0000"},{"text":"%spark2.pyspark\nrecommendUsersToItems = model.recommendUsersForProducts(10)","dateUpdated":"2018-08-08T02:05:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430657_592103100","id":"20180729-232108_1406108526","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4894","user":"anonymous","dateFinished":"2018-08-08T03:04:52+0000","dateStarted":"2018-08-08T02:10:10+0000"},{"text":"%spark2.pyspark\nrecommendUsersToItems.take(1)","dateUpdated":"2018-08-08T02:05:39+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[(185012, (Rating(user=163561, product=185012, rating=8.429775076251755e-05), Rating(user=138131, product=185012, rating=5.882106833710102e-05), Rating(user=286616, product=185012, rating=5.61873708797483e-05), Rating(user=350566, product=185012, rating=5.198710079554143e-05), Rating(user=76757, product=185012, rating=4.753026172325985e-05), Rating(user=53842, product=185012, rating=4.074835923484363e-05), Rating(user=316850, product=185012, rating=3.727773659335443e-05), Rating(user=1161163, product=185012, rating=3.1591901676133636e-05), Rating(user=389532, product=185012, rating=3.1494644750227756e-05), Rating(user=518659, product=185012, rating=3.0587585685103874e-05)))]\n"}]},"apps":[],"jobName":"paragraph_1533693430657_592103100","id":"20180730-122514_114563977","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4895","user":"anonymous","dateFinished":"2018-08-08T03:49:53+0000","dateStarted":"2018-08-08T03:04:52+0000"},{"text":"%spark2.pyspark\nrecommendUsersToItems.count()","dateUpdated":"2018-08-08T02:05:41+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"134109\n"}]},"apps":[],"jobName":"paragraph_1533693430657_592103100","id":"20180730-004049_1867346079","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4896","user":"anonymous","dateFinished":"2018-08-08T03:50:02+0000","dateStarted":"2018-08-08T03:04:52+0000"},{"text":"%spark2.pyspark\nrecommendItemsToUsers.count()","dateUpdated":"2018-08-08T02:05:43+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"200028\n"}]},"apps":[],"jobName":"paragraph_1533693430658_593257347","id":"20180729-202113_1992638714","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4897","user":"anonymous","dateFinished":"2018-08-08T03:50:12+0000","dateStarted":"2018-08-08T03:49:54+0000"},{"text":"%spark2.pyspark\n# product and user features\nproductFeatures = model.productFeatures().collect()\n","dateUpdated":"2018-08-08T02:05:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430658_593257347","id":"20180729-092239_1224090008","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4898","user":"anonymous","dateFinished":"2018-08-08T03:50:15+0000","dateStarted":"2018-08-08T03:50:03+0000"},{"text":"%spark2.pyspark\nproductFeatures_1 = sqlContext.createDataFrame(productFeatures)\nmodel.userFeatures().collect()\nproductFeatures_1.show(3)\n","dateUpdated":"2018-08-08T02:05:50+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+--------------------+\n| _1|                  _2|\n+---+--------------------+\n|  6|[4.34227185905911...|\n| 16|[4.08746855100616...|\n| 22|[2.10228881769580...|\n+---+--------------------+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430659_592872598","id":"20180729-092232_31097979","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4899","user":"anonymous","dateFinished":"2018-08-08T03:50:26+0000","dateStarted":"2018-08-08T03:50:13+0000"},{"text":"%spark2.pyspark\nfirst_product = model.productFeatures().take(1)[0]\nlatents = first_product[1]\nlen(latents)","dateUpdated":"2018-08-08T02:05:54+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"10\n"}]},"apps":[],"jobName":"paragraph_1533693430659_592872598","id":"20180729-092517_834363949","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4900","user":"anonymous","dateFinished":"2018-08-08T03:50:27+0000","dateStarted":"2018-08-08T03:50:16+0000"},{"text":"%spark2.pyspark\n# userFeatures\n\nfirst_user = model.userFeatures().take(1)[0]\nlatents = first_user[1]\nlen(latents)","dateUpdated":"2018-08-08T02:05:56+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"10\n"}]},"apps":[],"jobName":"paragraph_1533693430660_590948854","id":"20180729-092513_1635720730","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4901","user":"anonymous","dateFinished":"2018-08-08T03:50:27+0000","dateStarted":"2018-08-08T03:50:27+0000"},{"text":"%spark2.pyspark\nuserFeatures = model.userFeatures().collect()\nuserFeatures_1 = sqlContext.createDataFrame(userFeatures)\nuserFeatures_1.show(2)","dateUpdated":"2018-08-08T02:05:59+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+--------------------+\n| _1|                  _2|\n+---+--------------------+\n|  0|[-3.2352199923479...|\n|  2|[0.00325260753743...|\n+---+--------------------+\nonly showing top 2 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430660_590948854","id":"20180729-092341_1230257101","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4902","user":"anonymous","dateFinished":"2018-08-08T03:50:42+0000","dateStarted":"2018-08-08T03:50:27+0000"},{"text":"%spark2.pyspark\npredictions = model.predictAll(testdata).map(lambda r: ((r[0], r[1]),r[2]))\ntype(predictions)","dateUpdated":"2018-08-08T02:06:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.rdd.PipelinedRDD'>\n"}]},"apps":[],"jobName":"paragraph_1533693430661_590564105","id":"20180729-093423_562104182","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4903","user":"anonymous","dateFinished":"2018-08-08T03:50:55+0000","dateStarted":"2018-08-08T03:50:27+0000"},{"text":"%spark2.pyspark\n# Calculate rmse for ALS Collaborative Filtering\nfrom math import sqrt\n\nratesAndPreds = CountRating.map(lambda r: ((r[0],r[1]), r[2])).join(predictions)\n","dateUpdated":"2018-08-08T02:06:05+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430661_590564105","id":"20180729-092649_1572629692","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4904","user":"anonymous","dateFinished":"2018-08-08T03:50:55+0000","dateStarted":"2018-08-08T03:50:43+0000"},{"text":"%spark2.pyspark\nratesAndPreds.take(5)","dateUpdated":"2018-08-08T02:06:10+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[((1166553, 1945), (1.0, -3.932173681475539e-06)), ((1165148, 85774), (1.0, 0.1592316529589975)), ((336619, 160115), (1.0, 0.000263715880655321)), ((1202624, 97594), (1.0, 2.259080424498292e-06)), ((1334745, 437137), (1.0, 1.909432767668755e-48))]\n"}]},"apps":[],"jobName":"paragraph_1533693430661_590564105","id":"20180729-092646_1924888875","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4905","user":"anonymous","dateFinished":"2018-08-08T03:51:54+0000","dateStarted":"2018-08-08T03:50:56+0000"},{"text":"%spark2.pyspark\nMeanSquareError = ratesAndPreds.map(lambda r: (r[1][0]-r[1][1])**2).mean()\n\nprint(\"MeanSquareError = \" + str(MeanSquareError))","dateUpdated":"2018-08-08T02:06:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"MeanSquareError = 1.66695832443\n"}]},"apps":[],"jobName":"paragraph_1533693430661_590564105","id":"20180729-092643_1020873174","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4906","user":"anonymous","dateFinished":"2018-08-08T03:52:13+0000","dateStarted":"2018-08-08T03:50:56+0000"},{"text":"%spark2.pyspark\n# Root Mean Square Error\n\nfrom math import sqrt\nrmse = sqrt(MeanSquareError)\nprint(\"Root_Mean_Square_Error = \" + str(rmse))","dateUpdated":"2018-08-08T02:06:16+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Root_Mean_Square_Error = 1.29110740236\n"}]},"apps":[],"jobName":"paragraph_1533693430662_591718351","id":"20180729-094139_430533134","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4907","user":"anonymous","dateFinished":"2018-08-08T03:52:13+0000","dateStarted":"2018-08-08T03:51:54+0000"},{"text":"%spark2.pyspark\n## 2.  Model Evluation and Selection with Hyper Parameter Tuning\n\ndf = sqlContext.createDataFrame(CountRating)\n\ntype(df)","dateUpdated":"2018-08-08T02:06:18+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.sql.dataframe.DataFrame'>\n"}]},"apps":[],"jobName":"paragraph_1533693430662_591718351","id":"20180729-092803_1834151664","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4908","user":"anonymous","dateFinished":"2018-08-08T03:52:13+0000","dateStarted":"2018-08-08T03:52:13+0000"},{"text":"%spark2.pyspark\ndf.show(5)","dateUpdated":"2018-08-08T02:06:21+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----+-------+------+\n|user|product|rating|\n+----+-------+------+\n|1238|  76426|   1.0|\n|2659| 444820|   1.0|\n|2659| 293297|   1.0|\n|2866|  90950|   1.0|\n|2866| 294615|   1.0|\n+----+-------+------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1533693430662_591718351","id":"20180729-092816_1371474640","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4909","user":"anonymous","dateFinished":"2018-08-08T03:52:14+0000","dateStarted":"2018-08-08T03:52:14+0000"},{"text":"%spark2.pyspark\n# Split the input data into separate training and test datasets\n\n(training, test) = df.randomSplit([0.8,0.2])\n","dateUpdated":"2018-08-08T02:06:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430662_591718351","id":"20180729-092812_612587088","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4910","user":"anonymous","dateFinished":"2018-08-08T03:52:14+0000","dateStarted":"2018-08-08T03:52:14+0000"},{"text":"%spark2.pyspark\ntraining.count()","dateUpdated":"2018-08-08T02:06:28+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"705308\n"}]},"apps":[],"jobName":"paragraph_1533693430662_591718351","id":"20180729-092808_1276634571","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4911","user":"anonymous","dateFinished":"2018-08-08T03:52:28+0000","dateStarted":"2018-08-08T03:52:14+0000"},{"text":"%spark2.pyspark\ntest.count()","dateUpdated":"2018-08-08T02:06:30+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"176537\n"}]},"apps":[],"jobName":"paragraph_1533693430662_591718351","id":"20180729-092635_560299345","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4912","user":"anonymous","dateFinished":"2018-08-08T03:52:40+0000","dateStarted":"2018-08-08T03:52:15+0000"},{"text":"%spark2.pyspark\n# Apply implicit parameter to the data\n\nfrom pyspark.ml.recommendation import ALS\nals = ALS(implicitPrefs=True, userCol=\"user\", itemCol=\"product\", ratingCol=\"rating\", coldStartStrategy=\"drop\")\n","dateUpdated":"2018-08-08T02:06:33+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430662_591718351","id":"20180729-092942_1630148843","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4913","user":"anonymous","dateFinished":"2018-08-08T03:52:41+0000","dateStarted":"2018-08-08T03:52:28+0000"},{"text":"%spark2.pyspark\nals","dateUpdated":"2018-08-08T02:06:37+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"ALS_4365890d6aaa48202405\n"}]},"apps":[],"jobName":"paragraph_1533693430663_591333603","id":"20180729-093121_1297196177","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4914","user":"anonymous","dateFinished":"2018-08-08T03:52:41+0000","dateStarted":"2018-08-08T03:52:40+0000"},{"text":"%spark2.pyspark\nals.explainParams()","dateUpdated":"2018-08-08T02:06:48+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\"alpha: alpha for implicit preference (default: 1.0)\\ncheckpointInterval: set checkpoint interval (>= 1) or disable checkpoint (-1). E.g. 10 means that the cache will get checkpointed every 10 iterations. Note: this setting will be ignored if the checkpoint directory is not set in the SparkContext. (default: 10)\\ncoldStartStrategy: strategy for dealing with unknown or new users/items at prediction time. This may be useful in cross-validation or production scenarios, for handling user/item ids the model has not seen in the training data. Supported values: 'nan', 'drop'. (default: nan, current: drop)\\nfinalStorageLevel: StorageLevel for ALS model factors. (default: MEMORY_AND_DISK)\\nimplicitPrefs: whether to use implicit preference (default: False, current: True)\\nintermediateStorageLevel: StorageLevel for intermediate datasets. Cannot be 'NONE'. (default: MEMORY_AND_DISK)\\nitemCol: column name for item ids. Ids must be within the integer value range. (default: item, current: product)\\nmaxIter: max number of iterations (>= 0). (default: 10)\\nnonnegative: whether to use nonnegative constraint for least squares (default: False)\\nnumItemBlocks: number of item blocks (default: 10)\\nnumUserBlocks: number of user blocks (default: 10)\\npredictionCol: prediction column name. (default: prediction)\\nrank: rank of the factorization (default: 10)\\nratingCol: column name for ratings (default: rating, current: rating)\\nregParam: regularization parameter (>= 0). (default: 0.1)\\nseed: random seed. (default: 593367982098446717)\\nuserCol: column name for user ids. Ids must be within the integer value range. (default: user, current: user)\"\n"}]},"apps":[],"jobName":"paragraph_1533693430663_591333603","id":"20180729-093125_1476355061","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4915","user":"anonymous","dateFinished":"2018-08-08T03:52:41+0000","dateStarted":"2018-08-08T03:52:41+0000"},{"text":"%spark2.pyspark\nfrom pyspark.ml import Pipeline\n\npipeline = Pipeline(stages=[als])","dateUpdated":"2018-08-08T02:06:52+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430663_591333603","id":"20180729-093159_1271046875","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4916","user":"anonymous","dateFinished":"2018-08-08T03:52:41+0000","dateStarted":"2018-08-08T03:52:41+0000"},{"text":"%spark2.pyspark\ntype(pipeline)","dateUpdated":"2018-08-08T02:06:54+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<class 'pyspark.ml.pipeline.Pipeline'>\n"}]},"apps":[],"jobName":"paragraph_1533693430663_591333603","id":"20180729-093209_1705990970","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4917","user":"anonymous","dateFinished":"2018-08-08T03:52:41+0000","dateStarted":"2018-08-08T03:52:41+0000"},{"text":"%spark2.pyspark\n# Set the params\n\nfrom pyspark.ml.tuning import CrossValidator, ParamGridBuilder\n\nparamImplicit = ParamGridBuilder()\\\n.addGrid(als.rank,[5,10])\\\n.addGrid(als.maxIter,[5,10])\\\n.addGrid(als.regParam,[1.0,5.0])\\\n.build()\n","dateUpdated":"2018-08-08T02:06:56+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430663_591333603","id":"20180729-093242_1721272374","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4918","user":"anonymous","dateFinished":"2018-08-08T03:52:41+0000","dateStarted":"2018-08-08T03:52:41+0000"},{"text":"%spark2.pyspark\nfrom pyspark.ml.evaluation import RegressionEvaluator\n\nevaluatoR = RegressionEvaluator(metricName='rmse', labelCol='rating')\n","dateUpdated":"2018-08-08T02:07:00+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430663_591333603","id":"20180729-093751_537231161","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4919","user":"anonymous","dateFinished":"2018-08-08T03:52:41+0000","dateStarted":"2018-08-08T03:52:41+0000"},{"text":"%spark2.pyspark\n# Fit the estimator using params\n\ncvImplicit = CrossValidator(estimator=als, estimatorParamMaps=paramImplicit, evaluator=evaluatoR, numFolds=3)\n","dateUpdated":"2018-08-08T02:07:02+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430663_591333603","id":"20180729-093747_1271936691","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4920","user":"anonymous","dateFinished":"2018-08-08T03:52:42+0000","dateStarted":"2018-08-08T03:52:42+0000"},{"text":"%spark2.pyspark\ncvModel = cvImplicit.fit(training)\n","dateUpdated":"2018-08-08T02:07:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430664_589409858","id":"20180729-093743_982824652","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4921","user":"anonymous","dateFinished":"2018-08-08T04:19:52+0000","dateStarted":"2018-08-08T03:52:42+0000"},{"text":"%spark2.pyspark\n# Fit the model\n\n# Select the model produced by the best performance set of params\npreds = cvModel.bestModel.transform(test)\n\npreds.take(1)\n","dateUpdated":"2018-08-08T02:07:06+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[Row(user=557470, product=496, rating=1.0, prediction=0.0007645326550118625)]\n"}]},"apps":[],"jobName":"paragraph_1533693430664_589409858","id":"20180729-093852_1546716825","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4922","user":"anonymous","dateFinished":"2018-08-08T04:20:24+0000","dateStarted":"2018-08-08T03:52:42+0000"},{"text":"%spark2.pyspark\nevaluator = RegressionEvaluator(metricName='rmse', labelCol='rating', predictionCol='prediction')\n\nevaluator","dateUpdated":"2018-08-08T02:07:12+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"RegressionEvaluator_4bb6b07d00ef7b3a0036\n"}]},"apps":[],"jobName":"paragraph_1533693430664_589409858","id":"20180729-094035_906167842","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4923","user":"anonymous","dateFinished":"2018-08-08T04:20:24+0000","dateStarted":"2018-08-08T04:19:52+0000"},{"text":"%spark2.pyspark\n# Find Root Mean Square Error\n\nrmse = evaluator.evaluate(preds)\n","dateUpdated":"2018-08-08T02:07:14+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1533693430664_589409858","id":"20180729-094046_1335797558","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4924","user":"anonymous","dateFinished":"2018-08-08T04:20:56+0000","dateStarted":"2018-08-08T04:20:24+0000"},{"text":"%spark2.pyspark\nprint(\"Root-mean-square error =\"+str(rmse))\n","dateUpdated":"2018-08-08T02:07:18+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Root-mean-square error =1.18345875747\n"}]},"apps":[],"jobName":"paragraph_1533693430664_589409858","id":"20180729-094111_404881451","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4925","user":"anonymous","dateFinished":"2018-08-08T04:20:56+0000","dateStarted":"2018-08-08T04:20:24+0000"},{"text":"%spark2.pyspark\n","dateUpdated":"2018-08-08T02:07:21+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1533693430665_589025109","id":"20180729-231708_772318823","dateCreated":"2018-08-08T01:57:10+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:4926","user":"anonymous"}],"name":"Events2","id":"2DPG158VW","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}